{"ast":null,"code":"import { combineLatest, filter, map, switchMap } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"../admin.service\";\nimport * as i3 from \"@angular/forms\";\nimport * as i4 from \"@angular/common\";\nfunction AssignComponent_section_0_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 8)(1, \"label\", 9);\n    i0.ɵɵelement(2, \"input\", 10);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const student_r3 = ctx.$implicit;\n    const i_r4 = ctx.index;\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"formControlName\", i_r4);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\" \", student_r3.name, \" (\", student_r3.email, \") \");\n  }\n}\nfunction AssignComponent_section_0_p_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\", 11);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" Assigned IDs: \", ctx_r1.course == null ? null : ctx_r1.course.assignedStudentIds.join(\", \"), \" \");\n  }\n}\nfunction AssignComponent_section_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"section\", 2)(1, \"h2\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"form\", 3);\n    i0.ɵɵlistener(\"ngSubmit\", function AssignComponent_section_0_Template_form_ngSubmit_3_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.submit());\n    });\n    i0.ɵɵelementStart(4, \"div\", 4);\n    i0.ɵɵtemplate(5, AssignComponent_section_0_div_5_Template, 4, 3, \"div\", 5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"button\", 6);\n    i0.ɵɵtext(7, \"Save Assignments\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(8, AssignComponent_section_0_p_8_Template, 2, 1, \"p\", 7);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Assign Students to \", ctx_r1.course == null ? null : ctx_r1.course.title, \"\");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"formGroup\", ctx_r1.form);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.students);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.course == null ? null : ctx_r1.course.assignedStudentIds == null ? null : ctx_r1.course.assignedStudentIds.length);\n  }\n}\nfunction AssignComponent_ng_template_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"section\", 2)(1, \"p\");\n    i0.ɵɵtext(2, \"No course found for this assignment.\");\n    i0.ɵɵelementEnd()();\n  }\n}\nexport let AssignComponent = /*#__PURE__*/(() => {\n  class AssignComponent {\n    route;\n    adminService;\n    fb;\n    course;\n    students = [];\n    form;\n    get studentsArray() {\n      return this.form.get('students');\n    }\n    constructor(route, adminService, fb) {\n      this.route = route;\n      this.adminService = adminService;\n      this.fb = fb;\n    }\n    ngOnInit() {\n      this.form = this.fb.group({\n        students: this.fb.array([])\n      });\n      this.route.paramMap.pipe(map(params => Number(params.get('courseId'))), switchMap(courseId => combineLatest([this.adminService.getCourseById(courseId).pipe(filter(c => !!c)), this.adminService.getStudents()]).pipe(map(([course, students]) => ({\n        course,\n        students,\n        courseId\n      }))))).subscribe(({\n        course,\n        students\n      }) => {\n        this.course = course;\n        this.students = students;\n        this.setStudentControls(course.assignedStudentIds);\n      });\n    }\n    setStudentControls(selectedIds) {\n      this.studentsArray.clear();\n      this.students.forEach(student => {\n        this.studentsArray.push(this.fb.control(selectedIds.includes(student.id)));\n      });\n    }\n    submit() {\n      if (!this.course) {\n        return;\n      }\n      const selectedIds = this.students.map((student, index) => this.studentsArray.at(index).value ? student.id : null).filter(id => id !== null);\n      this.adminService.assignStudentsToCourse(this.course.id, selectedIds);\n    }\n    static ɵfac = function AssignComponent_Factory(t) {\n      return new (t || AssignComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.AdminService), i0.ɵɵdirectiveInject(i3.FormBuilder));\n    };\n    static ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: AssignComponent,\n      selectors: [[\"app-assign\"]],\n      decls: 3,\n      vars: 2,\n      consts: [[\"noCourse\", \"\"], [\"class\", \"card\", 4, \"ngIf\", \"ngIfElse\"], [1, \"card\"], [3, \"ngSubmit\", \"formGroup\"], [\"formArrayName\", \"students\"], [\"class\", \"student-row\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"submit\", 1, \"btn\"], [\"class\", \"muted\", 4, \"ngIf\"], [1, \"student-row\"], [3, \"formControlName\"], [\"type\", \"checkbox\"], [1, \"muted\"]],\n      template: function AssignComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵtemplate(0, AssignComponent_section_0_Template, 9, 4, \"section\", 1)(1, AssignComponent_ng_template_1_Template, 3, 0, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n        }\n        if (rf & 2) {\n          const noCourse_r5 = i0.ɵɵreference(2);\n          i0.ɵɵproperty(\"ngIf\", ctx.course)(\"ngIfElse\", noCourse_r5);\n        }\n      },\n      dependencies: [i4.NgForOf, i4.NgIf, i3.ɵNgNoValidate, i3.NgControlStatus, i3.NgControlStatusGroup, i3.FormGroupDirective, i3.FormControlName, i3.FormArrayName],\n      styles: [\".student-row[_ngcontent-%COMP%]{margin-bottom:8px}\"]\n    });\n  }\n  return AssignComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}